<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Aluma Banking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0a0f1c; color: #e2e8f0; display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: linear-gradient(180deg, #1a1f2e 0%, #141824 100%); padding: 20px 0; position: fixed; height: 100vh; border-right: 1px solid #2d3748; }
        .logo { padding: 0 20px 30px; border-bottom: 1px solid #2d3748; margin-bottom: 20px; }
        .logo h1 { font-size: 22px; color: #fff; display: flex; align-items: center; gap: 10px; }
        .logo h1 i { color: #3b82f6; }
        .logo span { font-size: 12px; color: #64748b; display: block; margin-top: 5px; }
        
        .nav-menu { list-style: none; }
        .nav-item { margin: 5px 10px; }
        .nav-item a { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: #94a3b8; text-decoration: none; border-radius: 8px; transition: all 0.3s; }
        .nav-item a:hover { background: #2d3748; color: #fff; }
        .nav-item a.active { background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%); color: #fff; }
        .nav-item i { width: 20px; text-align: center; }
        
        .nav-section { padding: 15px 20px 10px; font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Main Content */
        .main { flex: 1; margin-left: 250px; padding: 30px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h2 { font-size: 28px; font-weight: 600; }
        .header p { color: #64748b; margin-top: 5px; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .admin-badge { background: #1e293b; padding: 10px 20px; border-radius: 10px; display: flex; align-items: center; gap: 10px; }
        .admin-badge i { color: #3b82f6; }
        .btn-logout { background: #dc2626; color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-logout:hover { background: #b91c1c; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #1e293b 0%, #1a1f2e 100%); border-radius: 15px; padding: 25px; border: 1px solid #2d3748; }
        .stat-card .icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 15px; }
        .stat-card .icon.blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .stat-card .icon.green { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .stat-card .icon.yellow { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .stat-card .icon.purple { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .stat-card .value { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .stat-card .label { color: #64748b; font-size: 14px; }
        .stat-card .change { font-size: 12px; margin-top: 10px; color: #22c55e; }
        
        /* Content Grid */
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        
        .card { background: #1e293b; border-radius: 15px; padding: 25px; border: 1px solid #2d3748; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #2d3748; }
        .card-header h3 { font-size: 18px; font-weight: 600; }
        .card-header a { color: #3b82f6; text-decoration: none; font-size: 14px; }
        .card-header a:hover { text-decoration: underline; }
        
        /* Table */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; color: #64748b; font-size: 12px; text-transform: uppercase; border-bottom: 1px solid #2d3748; }
        td { padding: 15px 12px; border-bottom: 1px solid #2d3748; }
        tr:hover { background: rgba(255,255,255,0.02); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 40px; height: 40px; border-radius: 10px; background: #3b82f6; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .user-name { font-weight: 500; }
        .user-email { font-size: 12px; color: #64748b; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge.active { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .badge.pending { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .badge.suspended { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .btn-view { background: #3b82f6; color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .btn-view:hover { background: #2563eb; }
        
        /* Quick Actions */
        .quick-actions { display: flex; flex-direction: column; gap: 10px; }
        .action-btn { display: flex; align-items: center; gap: 12px; padding: 15px; background: #141824; border-radius: 10px; color: #e2e8f0; text-decoration: none; transition: all 0.3s; border: 1px solid #2d3748; }
        .action-btn:hover { background: #2d3748; transform: translateX(5px); }
        .action-btn i { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .action-btn .text { flex: 1; }
        .action-btn .title { font-weight: 500; margin-bottom: 3px; }
        .action-btn .desc { font-size: 12px; color: #64748b; }
        
        .loading { text-align: center; padding: 40px; color: #64748b; }
        
        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .content-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo">
            <h1><i class="fas fa-university"></i> Aluma</h1>
            <span>Admin Portal</span>
        </div>
        <div class="nav-section">Main</div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="admin-dashboard.html" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li class="nav-item"><a href="admin-account-management.html"><i class="fas fa-users"></i> Account Management</a></li>
            <li class="nav-item"><a href="#"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
        </ul>
        <div class="nav-section">Management</div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="#"><i class="fas fa-id-card"></i> KYC Approvals</a></li>
            <li class="nav-item"><a href="#"><i class="fas fa-headset"></i> Support Tickets</a></li>
            <li class="nav-item"><a href="#"><i class="fas fa-chart-bar"></i> Reports</a></li>
        </ul>
        <div class="nav-section">System</div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
            <li class="nav-item"><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </nav>

    <main class="main">
        <div class="header">
            <div>
                <h2>Dashboard</h2>
                <p id="currentDate">Loading...</p>
            </div>
            <div class="header-right">
                <div class="admin-badge"><i class="fas fa-user-shield"></i> <span id="adminName">Admin</span></div>
                <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card"><div class="icon blue"><i class="fas fa-users"></i></div><div class="value">-</div><div class="label">Total Users</div></div>
            <div class="stat-card"><div class="icon green"><i class="fas fa-wallet"></i></div><div class="value">-</div><div class="label">Active Accounts</div></div>
            <div class="stat-card"><div class="icon yellow"><i class="fas fa-clock"></i></div><div class="value">-</div><div class="label">Pending KYC</div></div>
            <div class="stat-card"><div class="icon purple"><i class="fas fa-dollar-sign"></i></div><div class="value">-</div><div class="label">Total Balance</div></div>
        </div>

        <div class="content-grid">
            <div class="card">
                <div class="card-header">
                    <h3>Recent Users</h3>
                    <a href="admin-account-management.html">View All <i class="fas fa-arrow-right"></i></a>
                </div>
                <div id="usersTable"><div class="loading">Loading users...</div></div>
            </div>

            <div class="card">
                <div class="card-header"><h3>Quick Actions</h3></div>
                <div class="quick-actions">
                    <a href="admin-account-management.html" class="action-btn">
                        <i class="fas fa-user-plus" style="background:rgba(59,130,246,0.2);color:#3b82f6;"></i>
                        <div class="text"><div class="title">Manage Users</div><div class="desc">View, edit, credit/debit accounts</div></div>
                        <i class="fas fa-chevron-right" style="color:#64748b;"></i>
                    </a>
                    <a href="#" class="action-btn">
                        <i class="fas fa-id-card" style="background:rgba(234,179,8,0.2);color:#eab308;"></i>
                        <div class="text"><div class="title">KYC Approvals</div><div class="desc">Review pending verifications</div></div>
                        <i class="fas fa-chevron-right" style="color:#64748b;"></i>
                    </a>
                    <a href="#" class="action-btn">
                        <i class="fas fa-chart-line" style="background:rgba(34,197,94,0.2);color:#22c55e;"></i>
                        <div class="text"><div class="title">View Reports</div><div class="desc">Analytics and statistics</div></div>
                        <i class="fas fa-chevron-right" style="color:#64748b;"></i>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        var API = 'https://aluma-banking-backend.onrender.com/api/v1';

        function getToken() {
            return localStorage.getItem('admin_access_token') || sessionStorage.getItem('admin_access_token');
        }

        function getHeaders() {
            return { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + getToken() };
        }

        function checkAuth() {
            if (!getToken()) { window.location.href = 'admin-login.html'; return false; }
            return true;
        }

        function formatCurrency(amount) {
            return '$' + parseFloat(amount || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function logout() {
            localStorage.removeItem('admin_access_token');
            localStorage.removeItem('admin_user');
            sessionStorage.removeItem('admin_access_token');
            sessionStorage.removeItem('admin_user');
            window.location.href = 'admin-login.html';
        }

        async function loadStats() {
            try {
                var res = await fetch(API + '/admin/dashboard/stats', { headers: getHeaders() });
                var data = await res.json();
                if (data.success) {
                    var s = data.data;
                    document.getElementById('statsGrid').innerHTML = 
                        '<div class="stat-card"><div class="icon blue"><i class="fas fa-users"></i></div><div class="value">' + (s.users.total_users || 0) + '</div><div class="label">Total Users</div><div class="change"><i class="fas fa-arrow-up"></i> ' + (s.users.new_users_30d || 0) + ' this month</div></div>' +
                        '<div class="stat-card"><div class="icon green"><i class="fas fa-wallet"></i></div><div class="value">' + (s.accounts.active_accounts || 0) + '</div><div class="label">Active Accounts</div><div class="change">' + (s.accounts.total_accounts || 0) + ' total</div></div>' +
                        '<div class="stat-card"><div class="icon yellow"><i class="fas fa-clock"></i></div><div class="value">' + (s.kyc.pending_kyc || 0) + '</div><div class="label">Pending KYC</div><div class="change">Needs review</div></div>' +
                        '<div class="stat-card"><div class="icon purple"><i class="fas fa-dollar-sign"></i></div><div class="value">' + formatCurrency(s.accounts.total_cash) + '</div><div class="label">Total Balance</div><div class="change">Platform funds</div></div>';
                }
            } catch (e) { console.error('Stats error:', e); }
        }

        async function loadUsers() {
            try {
                var res = await fetch(API + '/admin/users?limit=5&sort_by=created_at&sort_order=DESC', { headers: getHeaders() });
                var data = await res.json();
                if (data.success && data.data.length > 0) {
                    var html = '<table><thead><tr><th>User</th><th>Status</th><th>Joined</th><th>Action</th></tr></thead><tbody>';
                    data.data.forEach(function(u) {
                        var initial = (u.first_name || 'U').charAt(0).toUpperCase();
                        html += '<tr><td><div class="user-info"><div class="avatar">' + initial + '</div><div><div class="user-name">' + (u.first_name || '') + ' ' + (u.last_name || '') + '</div><div class="user-email">' + u.email + '</div></div></div></td>';
                        html += '<td><span class="badge ' + u.status + '">' + u.status + '</span></td>';
                        html += '<td>' + formatDate(u.created_at) + '</td>';
                        html += '<td><button class="btn-view" onclick="location.href=\'admin-account-management.html?user=' + u.id + '\'">Manage</button></td></tr>';
                    });
                    html += '</tbody></table>';
                    document.getElementById('usersTable').innerHTML = html;
                } else {
                    document.getElementById('usersTable').innerHTML = '<p style="text-align:center;color:#64748b;padding:20px;">No users found</p>';
                }
            } catch (e) { console.error('Users error:', e); document.getElementById('usersTable').innerHTML = '<p style="text-align:center;color:#ef4444;">Failed to load users</p>'; }
        }

        function init() {
            if (!checkAuth()) return;
            var user = JSON.parse(localStorage.getItem('admin_user') || sessionStorage.getItem('admin_user') || '{}');
            if (user.firstName) document.getElementById('adminName').textContent = user.firstName;
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            loadStats();
            loadUsers();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
    </html>
